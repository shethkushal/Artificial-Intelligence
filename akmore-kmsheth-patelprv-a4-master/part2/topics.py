'''
Assignment 4: Topic Classification
1) Train: While training we do not output anything on stdout. But we create two files in the same folder as the topic.py
 script.
    a) model_file : the file which is passed as argument to the script. We write out classifier model to this file, which
    is then used in test mode
    b) distinctive_words : this file contains the top 10 words for all 20 clusters, top words are the words that are
    strongly associated with the clusters

2) Test: For test mode, we output the confusion matrix and the accuracy as percentage for the current test.

Note: Please keep 'ignorewordlist.txt' file in the same directory as the script, this file contains stop words which
would be ignored by the classifier. We assume that data set directory will have subdirectories for all 20 topics.


Following are the few results:

a) Fraction = '1.0' : (Fully Supervised)
   Confusion Matrix =
                  |    atheism    |    autos     |   baseball   |  christian   |    crypto    | electronics  |   forsale    |   graphics   |     guns     |    hockey    |     mac      |   medical    |   mideast    | motorcycles  |      pc      |   politics   |   religion   |    space     |   windows    |   xwindows
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      atheism     |      255      |      0       |      0       |      22      |      2       |      0       |      0       |      0       |      2       |      1       |      0       |      2       |      4       |      1       |      2       |      2       |      22      |      3       |      0       |      1
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
       autos      |       0       |     356      |      0       |      1       |      1       |      4       |      9       |      1       |      0       |      1       |      1       |      1       |      0       |      15      |      1       |      5       |      0       |      0       |      0       |      0
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      baseball    |       1       |      2       |     365      |      2       |      0       |      0       |      1       |      0       |      0       |      15      |      0       |      3       |      1       |      2       |      0       |      4       |      0       |      1       |      0       |      0
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
     christian    |       3       |      0       |      1       |     370      |      0       |      0       |      0       |      2       |      0       |      0       |      0       |      3       |      0       |      0       |      0       |      3       |      14      |      1       |      1       |      0
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
       crypto     |       1       |      0       |      2       |      1       |     371      |      1       |      2       |      2       |      7       |      1       |      2       |      1       |      0       |      0       |      1       |      0       |      1       |      2       |      0       |      1
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    electronics   |       1       |      4       |      0       |      0       |      22      |     282      |      4       |      12      |      0       |      0       |      7       |      12      |      1       |      6       |      25      |      1       |      1       |      10      |      4       |      1
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      forsale     |       0       |      16      |      0       |      0       |      0       |      8       |     297      |      7       |      0       |      2       |      13      |      3       |      1       |      7       |      25      |      1       |      0       |      7       |      3       |      0
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      graphics    |       1       |      0       |      2       |      1       |      15      |      8       |      4       |     299      |      0       |      0       |      12      |      4       |      0       |      0       |      9       |      0       |      0       |      10      |      8       |      16
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        guns      |       0       |      0       |      0       |      1       |      5       |      1       |      0       |      0       |     329      |      0       |      0       |      2       |      1       |      2       |      0       |      13      |      9       |      1       |      0       |      0
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
       hockey     |       0       |      0       |      3       |      0       |      2       |      1       |      2       |      0       |      0       |     387      |      0       |      1       |      0       |      0       |      0       |      3       |      0       |      0       |      0       |      0
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        mac       |       0       |      1       |      0       |      0       |      4       |      12      |      8       |      12      |      0       |      0       |     317      |      2       |      1       |      1       |      18      |      0       |      0       |      6       |      3       |      0
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      medical     |       2       |      4       |      1       |      6       |      2       |      6       |      4       |      4       |      1       |      0       |      0       |     338      |      5       |      2       |      1       |      12      |      1       |      6       |      1       |      0
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      mideast     |       5       |      0       |      0       |      2       |      0       |      0       |      0       |      1       |      2       |      0       |      0       |      0       |     351      |      1       |      0       |      14      |      0       |      0       |      0       |      0
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    motorcycles   |       0       |      13      |      0       |      0       |      0       |      0       |      0       |      0       |      0       |      0       |      0       |      0       |      1       |     383      |      1       |      0       |      0       |      0       |      0       |      0
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
         pc       |       0       |      0       |      0       |      0       |      2       |      28      |      11      |      8       |      0       |      0       |      23      |      0       |      0       |      0       |     299      |      0       |      0       |      1       |      19      |      1
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      politics    |       7       |      1       |      1       |      0       |      3       |      0       |      0       |      0       |      72      |      0       |      0       |      2       |      3       |      0       |      0       |     199      |      12      |      10      |      0       |      0
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      religion    |       38      |      1       |      0       |      22      |      0       |      0       |      0       |      2       |      17      |      0       |      0       |      1       |      2       |      0       |      0       |      6       |     157      |      5       |      0       |      0
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
       space      |       3       |      1       |      0       |      2       |      2       |      3       |      1       |      3       |      2       |      0       |      0       |      4       |      0       |      0       |      2       |      7       |      0       |     360      |      0       |      4
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      windows     |       2       |      0       |      3       |      4       |      12      |      5       |      7       |      52      |      1       |      0       |      18      |      4       |      0       |      1       |      58      |      16      |      2       |      6       |     187      |      16
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      xwindows    |       0       |      1       |      1       |      0       |      6       |      2       |      1       |      53      |      0       |      0       |      1       |      2       |      0       |      2       |      7       |      0       |      0       |      4       |      7       |     308
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    Accuracy: 82.45%


b) Fraction = '0.1': (Semi Supervised)
    Confusion Matrix =
                  |    atheism    |    autos     |   baseball   |  christian   |    crypto    | electronics  |   forsale    |   graphics   |     guns     |    hockey    |     mac      |   medical    |   mideast    | motorcycles  |      pc      |   politics   |   religion   |    space     |   windows    |   xwindows
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      atheism     |      148      |      2       |      1       |      65      |      7       |      0       |      1       |      0       |      7       |      1       |      0       |      12      |      21      |      0       |      1       |      33      |      17      |      3       |      0       |      0
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
       autos      |       0       |     294      |      0       |      4       |      8       |      9       |      1       |      0       |      12      |      2       |      2       |      4       |      6       |      18      |      2       |      14      |      0       |      15      |      4       |      1
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      baseball    |       0       |      2       |     289      |      2       |      3       |      0       |      5       |      0       |      6       |      29      |      0       |      5       |      11      |      1       |      1       |      32      |      0       |      10      |      0       |      1
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
     christian    |       6       |      0       |      1       |     318      |      2       |      1       |      0       |      0       |      3       |      1       |      0       |      3       |      15      |      0       |      3       |      14      |      26      |      5       |      0       |      0
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
       crypto     |       0       |      1       |      0       |      0       |     360      |      2       |      0       |      2       |      11      |      0       |      2       |      0       |      1       |      0       |      1       |      13      |      0       |      3       |      0       |      0
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    electronics   |       0       |      31      |      0       |      5       |      72      |     139      |      6       |      1       |      12      |      3       |      28      |      10      |      7       |      4       |      17      |      4       |      0       |      46      |      6       |      2
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      forsale     |       0       |      27      |      5       |      3       |      9       |      13      |     184      |      3       |      8       |      3       |      46      |      3       |      11      |      3       |      45      |      5       |      0       |      13      |      8       |      1
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      graphics    |       0       |      2       |      2       |      1       |      58      |      3       |      5       |     108      |      8       |      3       |      21      |      5       |      3       |      3       |      27      |      11      |      1       |      51      |      37      |      40
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        guns      |       0       |      2       |      1       |      0       |      17      |      0       |      0       |      0       |     280      |      0       |      0       |      2       |      30      |      0       |      0       |      25      |      2       |      5       |      0       |      0
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
       hockey     |       0       |      0       |      12      |      0       |      1       |      1       |      0       |      2       |      3       |     365      |      1       |      1       |      3       |      0       |      1       |      5       |      0       |      3       |      1       |      0
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        mac       |       0       |      3       |      1       |      0       |      9       |      9       |      8       |      3       |      6       |      1       |     253      |      13      |      1       |      0       |      31      |      4       |      0       |      25      |      17      |      1
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      medical     |       4       |      5       |      2       |      12      |      10      |      5       |      2       |      2       |      10      |      2       |      2       |     263      |      30      |      1       |      3       |      25      |      5       |      13      |      0       |      0
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      mideast     |       3       |      0       |      1       |      1       |      3       |      1       |      0       |      0       |      3       |      2       |      0       |      0       |     338      |      0       |      0       |      21      |      0       |      3       |      0       |      0
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    motorcycles   |       1       |      37      |      3       |      5       |      6       |      5       |      2       |      0       |      14      |      5       |      1       |      10      |      19      |     259      |      0       |      17      |      0       |      13      |      0       |      1
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
         pc       |       0       |      2       |      1       |      1       |      17      |      18      |      8       |      3       |      2       |      2       |      57      |      1       |      3       |      0       |     224      |      0       |      0       |      10      |      39      |      4
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      politics    |       1       |      0       |      0       |      7       |      6       |      0       |      0       |      0       |      75      |      1       |      0       |      2       |      14      |      0       |      1       |     194      |      1       |      8       |      0       |      0
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      religion    |       24      |      2       |      0       |      68      |      9       |      3       |      0       |      0       |      19      |      1       |      0       |      2       |      21      |      0       |      0       |      8       |      91      |      3       |      0       |      0
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
       space      |       0       |      1       |      0       |      8       |      13      |      0       |      0       |      0       |      8       |      0       |      1       |      11      |      12      |      1       |      1       |      22      |      0       |     314      |      2       |      0
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      windows     |       0       |      4       |      2       |      0       |      29      |      3       |      8       |      5       |      8       |      0       |      37      |      3       |      8       |      0       |      50      |      11      |      0       |      20      |     191      |      15
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      xwindows    |       2       |      1       |      1       |      1       |      33      |      4       |      2       |      16      |      3       |      2       |      11      |      0       |      6       |      4       |      11      |      6       |      0       |      26      |      34      |     232
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    Accuracy: 64.31%


c) Fraction = 0.0: (Unsupervised)
    Confusion Matrix =
                  |    atheism    |    autos     |   baseball   |  christian   |    crypto    | electronics  |   forsale    |   graphics   |     guns     |    hockey    |     mac      |   medical    |   mideast    | motorcycles  |      pc      |   politics   |   religion   |    space     |   windows    |   xwindows
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      atheism     |       2       |      2       |      6       |      2       |      8       |      2       |      0       |      32      |      0       |     253      |      2       |      1       |      1       |      1       |      2       |      0       |      0       |      4       |      1       |      0
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
       autos      |       2       |      1       |      3       |      3       |      12      |      2       |      4       |      12      |      6       |     325      |      1       |      0       |      3       |      6       |      6       |      1       |      0       |      4       |      3       |      2
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      baseball    |       4       |      2       |      3       |      1       |      3       |      0       |      0       |      18      |      1       |     331      |      2       |      5       |      3       |      5       |      5       |      3       |      3       |      5       |      2       |      1
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
     christian    |       0       |      2       |      4       |      0       |      12      |      0       |      1       |      24      |      1       |     348      |      2       |      0       |      1       |      0       |      1       |      1       |      0       |      0       |      1       |      0
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
       crypto     |       0       |      4       |      12      |      1       |      11      |      1       |      2       |      31      |      2       |     312      |      1       |      1       |      1       |      3       |      1       |      0       |      1       |      2       |      6       |      4
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    electronics   |       5       |      9       |      14      |      4       |      4       |      4       |      1       |      23      |      2       |     294      |      2       |      2       |      2       |      6       |      4       |      5       |      3       |      3       |      2       |      4
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      forsale     |       10      |      8       |      15      |      6       |      6       |      7       |      5       |      4       |      15      |     227      |      10      |      8       |      12      |      15      |      5       |      6       |      2       |      10      |      8       |      11
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      graphics    |       2       |      1       |      6       |      3       |      6       |      13      |      6       |      20      |      5       |     271      |      9       |      2       |      7       |      6       |      3       |      3       |      2       |      8       |      6       |      10
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        guns      |       2       |      0       |      2       |      1       |      9       |      1       |      0       |      39      |      1       |     297      |      3       |      0       |      0       |      2       |      1       |      1       |      1       |      0       |      4       |      0
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
       hockey     |       3       |      3       |      2       |      0       |      4       |      3       |      1       |      22      |      1       |     320      |      5       |      6       |      2       |      4       |      5       |      5       |      2       |      4       |      5       |      2
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        mac       |       7       |      4       |      2       |      3       |      7       |      12      |      5       |      12      |      5       |     257      |      12      |      5       |      6       |      5       |      7       |      9       |      1       |      8       |      5       |      13
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      medical     |       0       |      2       |      8       |      0       |      5       |      3       |      0       |      46      |      0       |     306      |      2       |      0       |      1       |      4       |      1       |      6       |      2       |      4       |      3       |      3
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      mideast     |       1       |      1       |      1       |      0       |      20      |      0       |      0       |      82      |      0       |     250      |      6       |      0       |      4       |      0       |      1       |      1       |      3       |      0       |      6       |      0
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    motorcycles   |       9       |      7       |      9       |      4       |      2       |      10      |      9       |      12      |      13      |     255      |      10      |      8       |      6       |      3       |      14      |      7       |      8       |      8       |      3       |      1
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
         pc       |       5       |      1       |      11      |      4       |      2       |      4       |      2       |      0       |      3       |     294      |      17      |      7       |      7       |      7       |      3       |      2       |      1       |      11      |      5       |      6
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      politics    |       0       |      0       |      2       |      0       |      6       |      0       |      0       |      23      |      0       |     268      |      0       |      0       |      3       |      1       |      0       |      4       |      1       |      0       |      1       |      1
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      religion    |       0       |      1       |      7       |      2       |      11      |      3       |      2       |      16      |      0       |     200      |      0       |      1       |      0       |      0       |      0       |      1       |      2       |      3       |      0       |      2
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
       space      |       1       |      6       |      4       |      4       |      6       |      0       |      1       |      25      |      4       |     324      |      0       |      6       |      1       |      2       |      2       |      3       |      1       |      1       |      2       |      1
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      windows     |       3       |      7       |      9       |      2       |      8       |      4       |      4       |      6       |      2       |     284      |      6       |      3       |      4       |      4       |      9       |      5       |      7       |      14      |      9       |      4
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      xwindows    |       5       |      1       |      5       |      9       |      22      |      1       |      5       |      38      |      6       |     270      |      11      |      3       |      4       |      5       |      2       |      1       |      0       |      4       |      3       |      0
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    Accuracy: 5.38%


Complexity:
For fully supervised classifier, we are able to train the model pretty quickly(Within 2-3 minutes approximately)

For semi supervised classifier, the learning time depends on the fraction, smaller the fraction -> greater the time taken
to learn and classify the documents, because we have more unlabeled data for smaller fractions

For unsupervised classifier, the learning time is pretty quick as well, again it take around 3-4 minutes to learn

For testing the model, it takes around 2-3 minutes to test and calculate confusion matrix and accuracy

Please see the comments in the code section for explanation for the idea behind the implementation of different functions

Challenges:
The most challenging task was to relate and identify the topic title in case of unsupervised trainer. We did not had any
link between the data neither we had topic -> document relationship

Hence we assume that after we create clusters, there would be some human who would plug with topic for at least one file
from each cluster. Hence in case of unsupervised learning, after we create unlabeled cluster, we assume that we know
topic of at least one random document from each cluster, and then we assign that topic name to the entire cluster. Even
with this assumption, the accuracy was not as good as semi supervised learning.
'''


import sys
import os
import platform
from collections import defaultdict
import pickle
import math
import string
import random
import heapq
from copy import deepcopy


def train():
    if fraction == 1.0:
        supervised_bayes()

    if fraction < 1.0 and fraction > 0:
        semi_supervised()

    if fraction == 0.0:
        unsupervised()

    if fraction > 1 or fraction < 0:
        print "Invalid fraction, exiting"
        exit()


# Function to handle fully supervised learning when fraction is 1.0
def supervised_bayes():
    model = defaultdict(dd)
    for topic_dir in topics:
        for file_name in os.listdir(os.path.join(dataset_directory, topic_dir)):
            model[topic_dir]['TOTAL_DOCS'] += 1
            model['ALL_TOPICS']['TOTAL_DOCS'] += 1
            file = open(os.path.join(os.path.join(dataset_directory, topic_dir), file_name))
            word_list = file.read().split()
            for word in word_list:
                word = word.lower().translate(None, string.punctuation)
                if word not in ignore_word_list:
                    model[topic_dir][word] += 1
                    model[topic_dir]['TOTAL_WORDS'] += 1

    writeTop10Words(model)
    pickle.dump(model, open(model_file, "wb"))


'''
For semi supervised learning we follow following approach:
1. Use a flip coin approach with help of flip_coin() function. If the returned values is less than approach then label the file
else ignore the file and mark it as unlabeled
2. Create a classifier model using labeled files from step one
3. In a loop for a particular threshold(5 in our case),
    a. Classify unlabeled file using the classifier created in step 2
    b. Now using the new labels train the new model - model_improved
    c. repeat step 3 for the given threshold
'''


def semi_supervised():
    labeled_files = defaultdict(list)
    unlabeled_files = []
    classified_files = defaultdict(list)

    model = defaultdict(dd)

    for topic_dir in topics:
        for file_name in os.listdir(os.path.join(dataset_directory, topic_dir)):
            if flip_coin() <= fraction:
                labeled_files[topic_dir].append(os.path.join(os.path.join(dataset_directory, topic_dir), file_name))
            else:
                unlabeled_files.append(os.path.join(os.path.join(dataset_directory, topic_dir), file_name))
        if len(labeled_files[topic_dir]) == 0:
            labeled_files[topic_dir].append(os.path.join(os.path.join(dataset_directory, topic_dir),
                                                         os.listdir(os.path.join(dataset_directory, topic_dir))[0]))

    for topic_name in labeled_files:
        for file_path in labeled_files[topic_name]:
            model[topic_name]['TOTAL_DOCS'] += 1
            model['ALL_TOPICS']['TOTAL_DOCS'] += 1
            file = open(file_path)
            word_list = file.read().split()
            for word in word_list:
                word = word.lower().translate(None, string.punctuation)
                if word not in ignore_word_list:
                    model[topic_name][word] += 1
                    model[topic_name]['TOTAL_WORDS'] += 1

    threshold = 5

    for i in range(0, threshold + 1):
        model_improved = deepcopy(model)
        for topic_name in classified_files:
            for file_path in labeled_files[topic_name]:
                model_improved[topic_name]['TOTAL_DOCS'] += 1
                model_improved['ALL_TOPICS']['TOTAL_DOCS'] += 1
                file = open(file_path)
                word_list = file.read().split()
                for word in word_list:
                    word = word.lower().translate(None, string.punctuation)
                    if word not in ignore_word_list:
                        model_improved[topic_name][word] += 1
                        model_improved[topic_name]['TOTAL_WORDS'] += 1

        classified_files.clear()

        for file_path in unlabeled_files:
            file = open(file_path)
            word_list = file.read().split()
            max_topic = topics[0]
            max_prob = float('-inf')
            for topic_name in topics:
                current_prob = 0
                for word in word_list:
                    word = word.lower().translate(None, string.punctuation)
                    if model_improved[topic_name][word] != 0:
                        current_prob += math.log(
                            float(model_improved[topic_name][word]) / float(model_improved[topic_name]['TOTAL_WORDS']))
                    else:
                        current_prob += math.log(1E-8)
                current_prob += math.log(
                    float(model_improved[topic_name]['TOTAL_DOCS']) / float(model_improved['ALL_TOPICS']['TOTAL_DOCS']))

                if current_prob > max_prob:
                    max_prob = current_prob
                    max_topic = topic_name
            classified_files[max_topic].append(file_path)

    writeTop10Words(model_improved)
    pickle.dump(model_improved, open(model_file, "wb"))


'''
For unsupervised learning, we find a 'match' between two files. A 'match' is a count of common words shared by the two
 documents. If the 'match' is greater than a threshold(50) then we add those files to the same cluster or we move on
 with other document pairs. If there are any unpaired documents left after the process described earlier, then we add it
 randomly to some cluster.

 After the unlabeled clustered are created, we chose a one random file from the cluster and check its label. And then we
 assign that label to entire cluster. We repeat this for all the cluster. And after all the clusters are labeled we train
 our model by counting word frequencies.
'''


def unsupervised():
    documents = []
    # Creating a list of all files with file path
    for topic_dir in topics:
        for file_name in os.listdir(os.path.join(dataset_directory, topic_dir)):
            documents.append(os.path.join(os.path.join(dataset_directory, topic_dir), file_name))

    i = 0
    len_docs = len(documents)
    # We know that we have 20 clusters
    cluster_count = 20

    # We consider two documents in the same cluster if they have word match count greater than this threshold
    threshold = 100
    pseudo_topic_doc_map = defaultdict(list)

    while i < cluster_count:
        current_file_path = documents[i]
        pseudo_topic_doc_map[i].append(current_file_path)
        documents.remove(current_file_path)
        len_docs -= 1
        j = 0
        while j < len_docs:
            match = calculate_match(current_file_path, documents[j])
            if match > threshold:
                pseudo_topic_doc_map[i].append(documents[j])
                documents.remove(documents[j])
                len_docs -= 1
            j += 1
        i += 1

    # adding all the remaining docs equally after shuffling it
    random.shuffle(documents)

    slot_length = int(len(documents) / len(pseudo_topic_doc_map))
    current_pos = 0
    for index in pseudo_topic_doc_map:
        pseudo_topic_doc_map[index] += (documents[current_pos: current_pos + slot_length])
        current_pos += slot_length

    # Creating model using the unlabeled cluster
    # To label the cluster we would randomly select a file from unlabeled clusters and then assign topic of that file to entire cluster
    model = defaultdict(dd)
    topic_list = topics
    for index in pseudo_topic_doc_map:
        if platform.system() == "Windows":
            temp_topic_name = \
                pseudo_topic_doc_map[index][random.randint(0, len(pseudo_topic_doc_map[index]) - 1)].split("\\")[-2]
        else:
            temp_topic_name = \
                pseudo_topic_doc_map[index][random.randint(0, len(pseudo_topic_doc_map[index]) - 1)].split("/")[-2]
        if temp_topic_name in topic_list:
            current_topic = temp_topic_name
        else:
            current_topic = topic_list[random.randint(0, len(topic_list) - 1)]

        topic_list.remove(current_topic)

        for file_path in pseudo_topic_doc_map[index]:
            model[current_topic]['TOTAL_DOCS'] += 1
            model['ALL_TOPICS']['TOTAL_DOCS'] += 1
            file = open(file_path)
            word_list = file.read().split()
            for word in word_list:
                word = word.lower().translate(None, string.punctuation)
                if word not in ignore_word_list:
                    model[current_topic][word] += 1
                    model[current_topic]['TOTAL_WORDS'] += 1

    writeTop10Words(model)
    pickle.dump(model, open(model_file, "wb"))


# Create distinctive_words.txt with top 10 words for all the topics
def writeTop10Words(model):
    # Top 10 words with highest P(T = ti|Wj) is the top 10 words with highest frequency as Wj would be same for all words in a particular topic
    file = open("distinctive_words.txt", "wb")
    for topic_name in model:
        if topic_name != 'ALL_TOPICS':
            model[topic_name][''] = 0
            temp_dict = deepcopy(model[topic_name])
            temp_dict['TOTAL_WORDS'] = 0
            temp_dict['TOTAL_DOCS'] = 0
            top_10_list = heapq.nlargest(10, temp_dict, temp_dict.get)
            line = str(topic_name).ljust(12, ' ') + "| {" + ", ".join(map(str, top_10_list)) + "}\n"
            file.write(line)
    file.close()


# Calculates match between two document using common words count
def calculate_match(file_path_first, file_path_second):
    file_first = open(file_path_first)
    file_second = open(file_path_second)
    match = 0
    word_dict = defaultdict(int)

    for word in file_first.read().split():
        word = word.lower().translate(None, string.punctuation)
        word_dict[word] = 1

    for word in file_second.read().split():
        word = word.lower().translate(None, string.punctuation)
        if word_dict[word] == 1:
            match += 1

    return match


'''In test phase we use naive bayes to calculate the likelihood and priors. We use logarithms to avoid extremely small
values. We calculate posterior for the document with all the topics, and we select the one with maximum posterior out of
all these 20 posteriors and assign that topic to the document. Repeat this procedure for all the documents and then
calculate confusion matrix and accuracy
'''
def test():
    model = pickle.load(open(model_file, "rb"))
    true_count = 0
    false_count = 0

    confusion_matrix = defaultdict(dd)

    for topic_dir in topics:
        for file_name in os.listdir(os.path.join(dataset_directory, topic_dir)):
            file = open(os.path.join(os.path.join(dataset_directory, topic_dir), file_name))
            word_list = file.read().split()
            max_topic = topic_dir
            max_prob = float('-inf')
            for topic_name in topics:
                current_prob = 0
                for word in word_list:
                    word = word.lower().translate(None, string.punctuation)
                    if model[topic_name][word] != 0:
                        current_prob += math.log(
                            float(model[topic_name][word]) / float(model[topic_name]['TOTAL_WORDS']))
                    else:
                        current_prob += math.log(1E-8)
                current_prob += math.log(
                    float(model[topic_name]['TOTAL_DOCS']) / float(model['ALL_TOPICS']['TOTAL_DOCS']))

                if current_prob > max_prob:
                    max_prob = current_prob
                    max_topic = topic_name
            # print "Actual: " + topic_dir + ", Found: " + max_topic
            if max_topic == topic_dir:
                true_count += 1
            else:
                false_count += 1

            confusion_matrix[topic_dir][max_topic] += 1

    print " ".center(12, ' ') + "  |  " + " | ".join(str(topic_dir).center(12, ' ') for topic_dir in topics)
    print "".center(315, "-")
    for label_row in topics:
        print str(label_row).center(12, ' ') + "  |  " + " | ".join(
            str(confusion_matrix[label_row][label_col]).center(12, ' ') for label_col in topics)
        print "".center(315, "-")

    print "\n"
    print "Accuracy: " + "{0:.2%}".format(float(true_count) / (true_count + false_count))


def dd():
    return defaultdict(int)


def flip_coin():
    return random.uniform(0.0, 1.0)


if __name__ == "__main__":

    mode = sys.argv[1]
    fraction = 0
    # There are two modes, 1 Train and 2 Test
    modes = {
        'train': train,
        'test': test
    }
    # Check if mode passed is valid
    if mode not in modes:
        print "Invalid mode, exiting"
        exit()

    if mode == 'train':
        # We need fraction to be passed for training the classifier, hence we need 5 arguments including file name
        if len(sys.argv) != 5:
            print "Please pass [mode] [dataset-directory] [model-file] [fraction] as argument"
            print "Exiting"
            exit()
        fraction = float(sys.argv[4])
    else:
        # For test we need 4 arguments
        if len(sys.argv) != 4:
            print "Please pass [mode] [dataset-directory] [model-file] as argument"
            print "Exiting"
            exit()

    dataset_directory = sys.argv[2]
    model_file = sys.argv[3]

    # Check if directory exists
    if not os.path.isdir(dataset_directory):
        print "Invalid directory, exiting"
        exit()

    # Get list of topics as list
    topics = os.listdir(dataset_directory)

    # Delete .DS_Store from topics list if it is present
    if topics.__contains__(".DS_Store"):
        topics.remove(".DS_Store")

    # Storing words to be ignored in a dictionary
    ignore_word_list = {}
    for words in open("ignorewordlist.txt").readlines():
        ignore_word_list[words.strip()] = 1;

    modes[mode]()
